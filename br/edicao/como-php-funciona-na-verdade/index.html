<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <link rel="stylesheet" href="/assets/build/css/main.css?id=f17ea2107415981817ff">

  <title>Como o PHP funciona na verdade? | The PHP Website</title>

  <meta name="description" content="O desenvolvimento moderno de produtos requer cada vez menos conhecimento em linguagens de programa√ß√£o, arquitetura e ecossistemas. √â muito importante entend√™-los, por√©m. Hoje n√≥s falaremos sobre como o PHP funciona por baixo dos panos e como melhor tomar proveito da linguagem.">

  <meta property="og:title" content="Como o PHP funciona na verdade?">
  <meta property="og:description" content="O desenvolvimento moderno de produtos requer cada vez menos conhecimento em linguagens de programa√ß√£o, arquitetura e ecossistemas. √â muito importante entend√™-los, por√©m. Hoje n√≥s falaremos sobre como o PHP funciona por baixo dos panos e como melhor tomar proveito da linguagem.">
  <meta property="og:url" content="https://thephp.website/br/edicao/como-php-funciona-na-verdade">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@nawarian">
  <meta name="twitter:title" content="Como o PHP funciona na verdade?">
  <meta name="twitter:description" content="O desenvolvimento moderno de produtos requer cada vez menos conhecimento em linguagens de programa√ß√£o, arquitetura e ecossistemas. √â muito importante entend√™-los, por√©m. Hoje n√≥s falaremos sobre como o PHP funciona por baixo dos panos e como melhor tomar proveito da linguagem.">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151169766-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-151169766-2');
  </script>
</head>
<body class="yue">
  <header>
          <time datetime="2019-11-09">
        2019-11-09
      </time>
        <nav class="align-right">
      <a href="/br">üáßüá∑</a> | <a href="/en">üá¨üáß</a>
    </nav>
  </header>
<h1>Como o PHP funciona na verdade?</h1>

<p><a href="/en/issue/how-does-php-engine-actually-work/">Read in English</a></p>
<h2>TL;DR</h2>
<p>PHP √© uma linguagem de script que interpreta arquivos e os transforma
em opcodes, e executa estes opcodes para obter resultados. Opcache e
preloading ajudam PHP a remover a sobrecarga neste processo.</p>
<p>Em servidores web, PHP normalmente √© utilizado com PHP-FPM, que traz
consigo uma capacidade incr√≠vel de escalabilidade.</p>
<h2>Ent√£o... o que √© PHP?</h2>
<p>Eu fico muito feliz em ver como o desenvolvimento moderno com PHP
requer cada vez menos conhecimento para construir produtos incr√≠veis.
<strong>Isso √© muito massa!</strong></p>
<p>Numa pesquisa rapidinha a gente encontra a informa√ß√£o de que PHP
tornou-se p√∫blico cerca de <a href="https://groups.google.com/forum/#!msg/comp.infosystems.www.authoring.cgi/PyJ25gZ6z7A/M9FkTUVDfcwJ">24 anos atr√°s</a>.</p>
<p>A forma como PHP come√ßou √© extremamente importante pra entender como
e por qu√™ ele se tornou t√£o popular. Tamb√©m torna muito mais f√°cil
entender a maior parte de suas caracter√≠sticas e decis√µes arquiteturais.</p>
<p>PHP nasceu como uma template engine. Era uma s√©rie de programas CGI
que permitia o desenvolvimento de p√°ginas web como valores din√¢micos.</p>
<p>Sim, a ideia era justamente misturar HTML e PHP. S√≥ que em 1995 isso
era revolucion√°rio!</p>
<p>Como linguagem de script, PHP executa seus c√≥digos sequencialmente
do in√≠cio ao fim do arquivo e toda execu√ß√£o √© 100% nova. Sem
compartilhamento de mem√≥ria ou contexto.</p>
<p>Quando falamos de desenvolvimento web, isso pode mudar um pouco. Dado
que o PHP pode rodar como CGI ou m√≥dulo no servidor http. Vamos dar
uma olhada.</p>
<h3>Como o PHP funciona com servidores HTTP?</h3>
<p>Em geral, servidores HTTP t√™m uma responsabilidade bem clara:
prover conte√∫do de hiperm√≠dia usando o <a href="https://tools.ietf.org/html/rfc2616#page-7">Protocolo HTTP</a>.
Isto significa que <strong>servidores http recebem uma request, buscam
um conte√∫do do tipo string de algum lugar, e respondem com esta string</strong>
baseando-se no Protocolo HTTP.</p>
<p>PHP veio para tornar este conte√∫do de hiperm√≠dia din√¢mico, permitindo
que desenvolvedores possam prover mais que arquivos <code>.html</code> simples e
est√°ticos.</p>
<p>Enquanto linguagem de script, num contexto de scripting, o PHP isola
toda execu√ß√£o. Portanto n√£o compartilha mem√≥ria ou outros recursos entre
execu√ß√µes.</p>
<p>J√° enquanto no contexto web, temos duas formas diferentes de executar
c√≥digo PHP e cada uma possui seus pr√≥s e contras.</p>
<p>√â poss√≠vel conectar o PHP a servidores http utilizando uma conex√£o do
tipo CGI ou como um m√≥dulo. A maior diferen√ßa entre os dois modos √© que
<strong>m√≥dulos http compartilham recursos com o servidor HTTP</strong> enquanto no
modelo <strong>CGI, php faz uma execu√ß√£o nova a cada request</strong>.</p>
<p>Utilizar o PHP como m√≥dulo costumava ser bem popular, por sua
comunica√ß√£o com o servidor http ter menores barreiras. Ao passo que
um script CGI dependeria, por exemplo, de comunica√ß√£o em rede entre
o servidor http e a execu√ß√£o do c√≥digo.</p>
<p><strong>Isso costumava ser o gargalo em set ups PHP. Hoje em dia, √© justamente
onde o PHP brilha!</strong></p>
<p>Com o <a href="https://www.php.net/manual/en/install.fpm.php">PHP-FPM</a> um servidor
como nginx ou Apache podem facilmente executar c√≥digo php como se fosse
um script CLI. Onde cada request √© 100% isolada das outras.</p>
<p>Isto tamb√©m significa que o servidor HTTP pode escalar independentemente
do executor de c√≥digos PHP. Com as nossas tecnologias atuais, isso <strong>√©
incr√≠vel para nos permitir escalar verticalmente</strong>.</p>
<p>Utilizar o PHP com CGI lhe permite atualizar sua aplica√ß√£o rapidamente
sem precisar reiniciar o servidor HTTP a cada deployment. Com a moda
de utilizar load balancers isso n√£o √© t√£o cr√≠tico, mas vale mencionar.</p>
<p>Outro grande benef√≠cio de utilizar PHP-FPM √© que sempre que um script
php quebrar, apenas aquela request est√° comprometida. O restante da
aplica√ß√£o pode continuar executando normalmente, j√° que os recursos
n√£o s√£o compartilhados.</p>
<p>Ent√£o se a gente ignorar a utiliza√ß√£o do PHP como m√≥dulo, a forma como
ele funciona na web √© basicamente: <strong>HTTP Server ‚á® PHP-FPM (Server) ‚á® PHP</strong>.</p>
<p>E √© por isso que n√≥s dizemos normalmente que o PHP √© extremamente
escal√°vel por natureza.</p>
<p>Mas o PHP ainda √© uma linguagem de script. E como no contexto CGI ele
possui uma execu√ß√£o isolada a cada request, isso tamb√©m significa que
a sua caracter√≠stica mais escal√°vel tamb√©m √© um dos seus mais relevantes
gargalos de performance.</p>
<h3>Como o scripting com PHP funciona?</h3>
<p>A linguagem PHP √© escrita em C e a forma como funciona √© na real bem
massa.</p>
<p>O interpretador php l√™ arquivos contendo c√≥digo php, analiza sua sintaxe,
transforma tudo que entende como c√≥digo php em opcodes e mais tarde
executa esta lista de opcodes.</p>
<p>Em termos simplificados, o php: <strong>interpreta, compila e executa</strong>.</p>
<p>Toda as vezes novamente (a gente volta nesse ponto j√° j√°).</p>
<p>Ent√£o a cada vez que voc√™ tenta executar um script php, voc√™ encontrar√°
diferentes coisas em diferentes momentos:</p>
<p><strong>Erros sint√°ticos e verifica√ß√µes de linguagem acontecem durante a fase
de interpreta√ß√£o e compila√ß√£o. Erros l√≥gicos (como exce√ß√µes) ocorrem apenas
durante a fase de execu√ß√£o.</strong></p>
<p>A forma como o PHP faz isso √© atrav√©s de uma <a href="https://wiki.php.net/rfc/abstract_syntax_tree">√Årvore Sint√°tica Abstrata (Abstract Syntatic Tree - AST)</a>
para entender o que as coisas dentro do arquivo php significam.</p>
<p>Esta √°rvore sint√°tica mapeia estruturas de linguagem em instru√ß√µes de
compila√ß√£o, que quando compiladas se transformam em opcodes da Zend VM.
Tais opcodes ent√£o podem ser <a href="https://github.com/php/php-src/blob/master/Zend/zend_vm_def.h">interpretados pela Zend VM</a>.</p>
<p>Ent√£o se voc√™ parar pra pensar, <strong>a parte mais relevante na execu√ß√£o do c√≥digo
PHP ocorre quando a Zend VM executa opcodes</strong>. Isto √© o que realmente
produz o resultado que esperamos.</p>
<p>Ao fim do dia, <strong>ter uma execu√ß√£o isolada a cada request n√£o parece t√£o
inteligente se precisarmos compilar a sintaxe php em opcode a cada nova
request</strong>.</p>
<p>Por isso o <a href="https://www.php.net/manual/en/intro.opcache.php">OPcache</a>
existe. N√£o existem solu√ß√µes sem problemas.</p>
<p>Com OPcache o PHP pode tomar vantagem de um espa√ßo de mem√≥ria compartilhado:
ler/gravar scripts j√° interpretados e otimizar execu√ß√µes futuras.</p>
<p>Na primeira vez que uma request toca <code>index.php</code>, por exemplo, o php
interpreta, compila e executa. Da segunda vez que a request toca <code>index.php</code>,
o php simplesmente busca o compilado do OPcache e o executa.</p>
<p>Isto est√° para mudar, por√©m. Desde o PHP 7.4 um <a href="https://wiki.php.net/rfc/preload">preloader de opcache foi adicionado ao PHP</a>.
Esta funcionalidade permite uma s√©rie de arquivos php serem pr√©-carregados
ao subir o servidor. Desta forma, da primeira vez que uma request tocar
<code>index.php</code>, o php ir√° buscar o compilado diretamente no opcache. <strong>Sem
precisar interpretar o arquivo durante a request</strong>.</p>
<h3>E pra qu√™ tu t√° me dizendo tudo isso?</h3>
<p>Eu sinto que engenheiros(as) PHP (assim como python) normalmente possuem
grande conhecimento sobre como os componentes se conectam no back-end,
dado que nossas linguagens normalmente n√£o prov√©m muita m√°gica ou
software caixa preta de terceiros.</p>
<p>Eu tamb√©m sinto que isto vem mudando com o tempo, dado que o software
Open Source se mostrou mais que somente um Hype, mas um √≥timo modelo
econ√¥mico. Mais linguagens precisam que seus(uas) engenheiros(as)
entendam como as coisas se encaixam e est√£o se tornando cada vez mais
vendor agnostic.</p>
<p>Mas ainda n√£o estamos l√°, e dominar o ecossistema PHP √© necess√°rio
para investir esfor√ßos em performance e seguran√ßa corretamente. Saber
quando e onde as coisas acontecem ir√° lhe dar suporte em otimizar
como elas devem acontecer.</p>
<p>Eu espero que este texto tenha lhe ajudado a entender melhor como a
engine PHP funciona por baixo dos panos, o ferrament√°rio que utiliza e
palavras chave importantes que voc√™ provavelmente ir√° encarar em algum
momento.</p>
<p>Se voc√™ tiver alguma pergunta que eu n√£o tenha respondido aqui ou
cr√™ que cometi algum erro neste texto, sinta-se livre para entrar
em contato e, se eu entender que se encaixa aqui, vou manter este post
atualizado para que possamos aprender juntos.</p>
<div class="align-right">
  --
  <a href="https://twitter.com/nawarian">
    @nawarian
  </a>
</div>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Como o PHP funciona na verdade?",
  "description": "O desenvolvimento moderno de produtos requer cada vez menos conhecimento em linguagens de programa&ccedil;&atilde;o, arquitetura e ecossistemas. &Eacute; muito importante entend&ecirc;-los, por&eacute;m. Hoje n&oacute;s falaremos sobre como o PHP funciona por baixo dos panos e como melhor tomar proveito da linguagem.",
  "image": [
    "https://thephp.website/assets/images/2-engine.jpg"
   ],
  "datePublished": "2019-11-09T00:00:00+08:00",
  "dateModified": "2019-11-09T00:00:00+08:00",
  "author": {
    "@type": "Person",
    "name": "Nawarian N&iacute;ckolas Da Silva"
  },
   "publisher": {
    "@type": "Organization",
    "name": "ThePHP Website",
    "logo": {
      "@type": "ImageObject",
      "url": "https://thephp.website/favicon.ico"
    }
  }
}
</script></body>
<script src="/assets/build/js/main.js?id=859740b518dcddb1fe42"></script>
</html>
